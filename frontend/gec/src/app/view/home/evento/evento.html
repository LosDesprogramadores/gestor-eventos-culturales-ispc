<app-banner></app-banner>

<div class="filter-bar">
  <div class="filter-group">
    <select class="filter-select" (change)="onCategoriaChange($any($event.target).value)">
      <option value="">Todas las categor√≠as</option>
      @if (categorias$ | async; as cats) {
        @for (cat of cats; track cat.id) {
          <option [value]="cat.id">{{ cat.name }}</option>
        }
      }
    </select>
  </div>

  <input class="filter-search"
         type="search"
         placeholder="Buscar t√≠tulo"
         (input)="onSearchChange($any($event.target).value)" />
</div>

<div class="container my-5">
  <div class="row g-2">
    @if (filteredEventos$ | async; as eventos) {
      @for (evento of eventos; track evento.getId()) {
        <div class="col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 shadow-sm">

            <!-- Imagen + sticker -->
            <div class="imagen-evento position-relative">
              <span class="cat-badge"
                    [ngClass]="'cat-' + getCategoriaId(evento)">
                {{ categoriaNombreFromEvento(evento) }}
              </span>

              <img [src]="evento.getImagen()"
                   alt="Evento"
                   onerror="this.src='/assets/images/sin.jpg'"
                   class="card-img-top img-hover-scale object-fit-cover">
            </div>

            <div class="card-body">
              <h5 class="card-title titulo text-center">{{ evento.getNombre() }}</h5>

              @if (evento.getCapacidad() === evento.getInscriptos()) {
                <p class="mb-1 text-danger fw-bold">üéüÔ∏è ¬°ENTRADAS AGOTADAS!</p>
              } @else {
                <p class="mb-1"><strong>Capacidad:</strong> {{ evento.getCapacidad() }}</p>
            <!-- <p class="mb-1"><strong>Inscriptos:</strong> {{ evento.getInscriptos() }}</p>  -->
              }

              <p class="lugar mb-1"><strong>Ubicaci√≥n:</strong> {{evento.getUbicacion()}}</p>
              <p class="fecha mb-0">{{ evento.getFechaHoraEvento() | date:'dd/MM/yyyy , HH:mm'}} hs</p>
            </div>

            <div class="botones-card px-3 pb-3 d-flex gap-2">
              <a class="btn btn-primary btn-sm flex-fill"
                 [routerLink]="['/home/evento/detalle-evento', evento.getId()]">
                Ver m√°s
              </a>
              <button class="btn btn-success btn-sm flex-fill"
                      (click)="confirmarInscripcion(evento)" 
                      [disabled]="evento.getCapacidad() === evento.getInscriptos()">
                Inscribirse
              </button>
            </div>
          </div>
        </div>
      } @empty {
        <div class="col-12 text-center">
          <img src="/assets/images/no-hay-eventos.png" alt="No hay Eventos" class="img-fluid">
          <p class="mt-3">No se encontraron eventos disponibles.</p>
        </div>
      }
    } @else {
      <div class="row d-flex justify-content-center align-self-center">
        <div class="col-md-3 mb-4 text-center">
          <div class="card h-100 shadow-sm small-card">
            <img src="/assets/images/no-hay-eventos.png" alt="No hay Eventos">
          </div>
        </div>
      </div>
    }
  </div>
</div>

<div class="modal fade" 
     [ngClass]="{'show d-block': eventoAConfirmar}" 
     tabindex="-1" 
     aria-labelledby="confirmModalLabel" 
     [attr.aria-hidden]="!eventoAConfirmar">

  <div class="modal-dialog modal-dialog-centered">
    @if (eventoAConfirmar) {
      <div class="modal-content">
        
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="confirmModalLabel">Confirmaci√≥n de Inscripci√≥n</h5>
          <button type="button" 
                  class="btn-close btn-close-white" 
                  (click)="eventoAConfirmar = null" 
                  aria-label="Cerrar"></button>
        </div>

        <div class="modal-body">
          <p class="fw-bold">¬øRealmente deseas inscribirte en el siguiente evento?</p>
          
          <div class="p-3 border rounded">
            <h6 class="mb-1 text-primary">{{ eventoAConfirmar.getNombre() }}</h6>
            <small class="text-muted d-block">
              <i class="bi bi-geo-alt-fill me-1"></i> {{ eventoAConfirmar.getUbicacion() }}
            </small>
            <small class="text-muted d-block">
              <i class="bi bi-calendar-event me-1"></i> 
              {{ eventoAConfirmar.getFechaHoraEvento() | date:'dd/MM/yyyy , HH:mm'}} hs
            </small>
          </div>
          
          <p class="mt-3 mb-0 text-danger small">
            Una vez inscrito, el cupo quedar√° reservado a tu nombre.
          </p>
        </div>

        <div class="modal-footer">
          <button type="button" 
                  class="btn btn-secondary" 
                  (click)="eventoAConfirmar = null">
            Cancelar
          </button>
        
          <button type="button" 
                  class="btn btn-success" 
                  (click)="ejecutarInscripcion()">
            <i class="bi bi-check-circle-fill me-1"></i> ¬°Confirmar Inscripci√≥n!
          </button>
        </div>
      </div>
    }
  </div>
</div>

@if (eventoAConfirmar) {
  <div class="modal-backdrop fade show"></div>
}
